{% extends "base/github_base.html" %}

{% block title %}Lectures - Project Bach{% endblock %}
{% block description %}Academic lectures and course materials analyzed with AI-powered insights{% endblock %}

{% block page_title %}🎓 Lectures{% endblock %}
{% block page_subtitle %}Academic content and course materials{% endblock %}

{% block main_content %}
<section class="content-filters">
    <div class="filter-controls">
        <button class="filter-btn active" data-filter="all">All Lectures</button>
        <button class="filter-btn" data-filter="recent">Recent</button>
        <button class="filter-btn" data-filter="popular">Most Viewed</button>
    </div>
    
    <div class="search-box">
        <input type="search" id="lecture-search" placeholder="Search lectures..." class="form-input">
        <button class="search-btn">🔍</button>
    </div>
</section>

{% if lectures %}
<section class="lecture-grid">
    {% for lecture in lectures %}
    <article class="result-item card content-lecture" data-category="lecture">
        <header class="result-header">
            <div class="result-title">
                <h3>
                    <a href="{{ lecture.url or '#' }}">
                        {{ lecture.title or lecture.filename }}
                    </a>
                </h3>
            </div>
            <span class="result-type lecture">🎓 Lecture</span>
        </header>
        
        <div class="result-meta">
            <span class="meta-item">
                <span class="meta-icon">📅</span>
                {{ lecture.created_at | timeago if lecture.created_at else 'Recently' }}
            </span>
            
            {% if lecture.duration %}
            <span class="meta-item">
                <span class="meta-icon">⏱️</span>
                {{ lecture.duration }}
            </span>
            {% endif %}
            
            {% if lecture.course %}
            <span class="meta-item">
                <span class="meta-icon">📚</span>
                {{ lecture.course }}
            </span>
            {% endif %}
            
            {% if lecture.language %}
            <span class="meta-item">
                <span class="meta-icon">🌍</span>
                {{ lecture.language | title }}
            </span>
            {% endif %}
        </div>
        
        {% if lecture.summary %}
        <div class="result-summary">
            {{ lecture.summary | truncate(200) }}
        </div>
        {% endif %}
        
        {% if lecture.topics %}
        <div class="result-tags">
            {% for topic in lecture.topics[:5] %}
            <span class="result-tag">{{ topic }}</span>
            {% endfor %}
            {% if lecture.topics | length > 5 %}
            <span class="result-tag more">+{{ lecture.topics | length - 5 }} more</span>
            {% endif %}
        </div>
        {% endif %}
        
        <footer class="result-footer">
            <div class="result-actions">
                <a href="{{ lecture.url or '#' }}" class="btn btn-primary btn-sm">
                    📖 Read Analysis
                </a>
                {% if lecture.transcript_url %}
                <a href="{{ lecture.transcript_url }}" class="btn btn-secondary btn-sm">
                    📝 Transcript
                </a>
                {% endif %}
            </div>
            
            {% if lecture.stats %}
            <div class="result-stats">
                {% if lecture.stats.views %}
                <span class="stat">👀 {{ lecture.stats.views }}</span>
                {% endif %}
                {% if lecture.stats.rating %}
                <span class="stat">⭐ {{ lecture.stats.rating }}/5</span>
                {% endif %}
            </div>
            {% endif %}
        </footer>
    </article>
    {% endfor %}
</section>

<nav class="pagination">
    {% if pagination.prev_url %}
    <a href="{{ pagination.prev_url }}" class="pagination-link prev">← Previous</a>
    {% endif %}
    
    <span class="pagination-info">
        Page {{ pagination.page or 1 }} of {{ pagination.pages or 1 }}
        ({{ pagination.total or lectures|length }} lectures)
    </span>
    
    {% if pagination.next_url %}
    <a href="{{ pagination.next_url }}" class="pagination-link next">Next →</a>
    {% endif %}
</nav>

{% else %}
<section class="empty-state">
    <div class="empty-icon">🎓</div>
    <h3 class="empty-title">No Lectures Yet</h3>
    <p class="empty-description">
        Upload your first lecture or course material to get started with AI-powered analysis.
    </p>
    <div class="empty-actions">
        <a href="{{ url_for('upload_page') }}" class="btn btn-primary">
            📤 Upload Lecture
        </a>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">
            🏠 Back to Home
        </a>
    </div>
</section>
{% endif %}

<aside class="lecture-stats card">
    <h3>📊 Lecture Statistics</h3>
    <div class="stats-grid">
        <div class="stat-item">
            <div class="stat-value">{{ total_lectures or 0 }}</div>
            <div class="stat-label">Total Lectures</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">{{ total_hours or '0h' }}</div>
            <div class="stat-label">Content Hours</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">{{ courses_count or 0 }}</div>
            <div class="stat-label">Courses</div>
        </div>
        <div class="stat-item">
            <div class="stat-value">{{ avg_duration or '0m' }}</div>
            <div class="stat-label">Avg Duration</div>
        </div>
    </div>
</aside>
{% endblock %}

{% block additional_js %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Filter functionality
    const filterButtons = document.querySelectorAll('.filter-btn');
    const lectureItems = document.querySelectorAll('.result-item');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            const filter = this.dataset.filter;
            
            // Update active button
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // Filter items
            lectureItems.forEach(item => {
                if (filter === 'all' || item.dataset.category === filter) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    });
    
    // Search functionality
    const searchInput = document.getElementById('lecture-search');
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            
            lectureItems.forEach(item => {
                const title = item.querySelector('h3').textContent.toLowerCase();
                const summary = item.querySelector('.result-summary')?.textContent.toLowerCase() || '';
                
                if (title.includes(searchTerm) || summary.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    }
});
</script>
{% endblock %}