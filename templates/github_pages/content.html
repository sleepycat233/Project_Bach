{% extends "base/github_base.html" %}

{% block title %}{{ content.title or content.filename }} - Project Bach{% endblock %}
{% block description %}{{ content.summary | truncate(160) if content.summary else 'AI-analyzed content from Project Bach' }}{% endblock %}

{% block page_title %}{{ content.title or content.filename }}{% endblock %}
{% block page_subtitle %}
<span class="content-type-badge {{ content.content_type }}">
    {% if content.content_type == 'lecture' %}🎓 Lecture
    {% elif content.content_type == 'youtube' %}📺 Video
    {% elif content.content_type == 'rss' %}📰 Article
    {% elif content.content_type == 'podcast' %}🎙️ Podcast
    {% else %}📝 Content
    {% endif %}
</span>
{% endblock %}

{% block main_content %}
<article class="content-detail">
    <header class="content-header">
        <div class="content-meta">
            <div class="meta-grid">
                <div class="meta-item">
                    <span class="meta-label">📅 Processed:</span>
                    <span class="meta-value">{{ content.created_at | strftime('%Y-%m-%d %H:%M') if content.created_at else 'Unknown' }}</span>
                </div>
                
                {% if content.duration %}
                <div class="meta-item">
                    <span class="meta-label">⏱️ Duration:</span>
                    <span class="meta-value">{{ content.duration }}</span>
                </div>
                {% endif %}
                
                {% if content.language %}
                <div class="meta-item">
                    <span class="meta-label">🌍 Language:</span>
                    <span class="meta-value">{{ content.language | title }}</span>
                </div>
                {% endif %}
                
                {% if content.model_used %}
                <div class="meta-item">
                    <span class="meta-label">🤖 AI Model:</span>
                    <span class="meta-value">{{ content.model_used }}</span>
                </div>
                {% endif %}
                
                {% if content.file_size %}
                <div class="meta-item">
                    <span class="meta-label">📦 File Size:</span>
                    <span class="meta-value">{{ content.file_size }}</span>
                </div>
                {% endif %}
            </div>
        </div>
        
        {% if content.tags %}
        <div class="content-tags">
            {% for tag in content.tags %}
            <span class="tag">{{ tag }}</span>
            {% endfor %}
        </div>
        {% endif %}
    </header>
    
    {% if content.summary %}
    <section class="content-section">
        <h2>📋 Summary</h2>
        <div class="content-summary card">
            {{ content.summary | markdown if content.summary else 'No summary available.' }}
        </div>
    </section>
    {% endif %}
    
    {% if content.key_points %}
    <section class="content-section">
        <h2>🎯 Key Points</h2>
        <div class="key-points card">
            {% if content.key_points is string %}
                {{ content.key_points | markdown }}
            {% elif content.key_points is iterable %}
                <ul>
                {% for point in content.key_points %}
                    <li>{{ point }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        </div>
    </section>
    {% endif %}
    
    {% if content.mind_map %}
    <section class="content-section">
        <h2>🧠 Mind Map</h2>
        <div class="mind-map card">
            <pre><code>{{ content.mind_map }}</code></pre>
        </div>
    </section>
    {% endif %}
    
    {% if content.transcript %}
    <section class="content-section">
        <h2>📝 Transcript</h2>
        <div class="transcript card">
            <div class="transcript-controls">
                <button class="btn btn-secondary" onclick="toggleTranscript()">
                    <span id="transcript-toggle-text">Show Full Transcript</span>
                </button>
            </div>
            <div id="transcript-content" class="transcript-content" style="display: none;">
                <pre>{{ content.transcript }}</pre>
            </div>
        </div>
    </section>
    {% endif %}
    
    {% if content.source_url %}
    <section class="content-section">
        <h2>🔗 Source</h2>
        <div class="source-link card">
            <a href="{{ content.source_url }}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                {% if content.content_type == 'youtube' %}📺 View on YouTube
                {% elif content.content_type == 'rss' %}📰 Read Original Article
                {% else %}🔗 View Source
                {% endif %}
            </a>
        </div>
    </section>
    {% endif %}
</article>

<nav class="content-navigation">
    {% if prev_content %}
    <a href="{{ prev_content.url }}" class="nav-link prev">
        ← {{ prev_content.title or prev_content.filename | truncate(30) }}
    </a>
    {% endif %}
    
    <a href="{{ url_for('index') }}" class="nav-link home">🏠 Home</a>
    
    {% if next_content %}
    <a href="{{ next_content.url }}" class="nav-link next">
        {{ next_content.title or next_content.filename | truncate(30) }} →
    </a>
    {% endif %}
</nav>
{% endblock %}

{% block additional_js %}
{{ super() }}
<script>
function toggleTranscript() {
    const content = document.getElementById('transcript-content');
    const toggleText = document.getElementById('transcript-toggle-text');
    
    if (content.style.display === 'none') {
        content.style.display = 'block';
        toggleText.textContent = 'Hide Transcript';
    } else {
        content.style.display = 'none';
        toggleText.textContent = 'Show Full Transcript';
    }
}
</script>
{% endblock %}